# 6장. 메모리와 캐시 메모리

## 6-1. RAM 의 특징과 종류

> _주기억 장치는 크게 RAM, ROM 이 있고, 일반적으론 RAM 을 메모리로 지칭하는 경우가 많다._ > _해당 장에선 RAM 에 대해 자세히 알아본다._

### RAM 의 특징

- 휘발성
  - 휘발성 저장 장치(volatile memory): 전원을 끌 경우 저장된 명령어, 데이터가 모두 날아간다.
  - 비휘발성 저장 장치(non-volatile memory): 전원이 꺼져도 저장된 내용이 유지된다.
- RAM 은 **휘발성 저장 장치**이다.

### RAM 의 용량과 성능

- CPU 가 실행하고자 하는 프로그램이 보조기억장치에 있는 경우, RAM 으로 가져와야 한다.
  - RAM 의 용량이 작으면 가져오는 시간이 잦아 실행 시간이 길어진다.
  - RAM 용량이 크면 가져오는 시간이 상대적으로 적으므로,
    많은 프로그램들을 동시에 빠르게 실행하는 데 유리하다.

### RAM 의 종류

- DRAM (Dynamic RAM)
  - 데이터가 동적으로 사라지는 RAM.
  - 데이터의 소멸을 막기 위해 일정 주기로 데이터를 재활성화(다시 저장) 해야 한다.
  - 소비 전력이 비교적 낮고, 저렴하고, 집적도가 높다.
    - 따라서 대용량 설계가 용이하다.
  - 일반적으로 메모리로써 사용하는 RAM 이다.
- SRAM (Static RAM)
  - 데이터가 시간이 지나도 사라지지 않는 RAM. (비휘발성 메모리는 아니다.)
  - 일반적으로 DRAM 보다 속도가 더 빠르다.
  - DRAM 에 비해 소비 전력이 높고, 비싸고, 집적도가 낮다.
  - 주로 캐시 메모리에서 사용된다.
- SDRAM (Synchronous Dynamic RAM)
  - 클럭 신호와 동기화된 DRAM 이다.
    - 즉, 클럭 타이밍에 맞춰 CPU 와 정보를 주고받을 수 있다.
  - 한 클럭에 한 번씩 CPU 와 데이터를 주고받을 수 있다.
- DDR SDRAM (Double Data Rate SDRAM)
  - 대역폭을 넓혀 속도를 빠르게 만든 SDRAM 이다.
  - SDRAM 에 비해 두 배의 대역폭으로 한 클럭당 두 번씩 CPU 와 데이터를 주고받을 수 있다.
  - DDR2 SDRAM 은 DDR SDRAM 에 두 배, DDR3은 DDR2 에 비해 대역폭이 두 배 넓다.
  - 최근 가장 흔히 사용되고 있다.

## 6-2. 메모리의 주소 공간

> _주소에는 물리 / 논리 주소가 있다._ > _해당 절에선 이에 대한 배경과 정의, 변환 방법에 대해 알아본다._

### 물리 주소와 논리 주소

- 왜 주소의 개념이 나눠졌는가?

  - 메모리에 저장된 정보는 시시각각 변한다.
  - CPU 와 실행 중인 프로그램이 현재 메모리 번지에 무엇이 저장되어 있는지 모두 파악하기엔 어렵다.

- 주소의 정의

  - 물리 주소: 정보가 실제로 저장된 하드웨어 상의 주소이다.

  - 논리 주소: 실행 중인 프로그램 각각에 부여된 0번지 부터 시작하는 주소이다.

- 논리 주소는 어떻게 물리 주소로 변환되는가?

  - MMU (Memory Management Unit) 에 의해 수행된다.
  - MMU 는 CPU 와 주소 버스 사이에 위치하게 된다.
  - CPU 가 발생 시킨 논리 주소에 Base Register 값을 더하여 논리 주소를 물리 주소로 변환한다.

### 메모리 보호 기법

- 만약 CPU 의 논리 주소가 특정 프로그램이 차지하는 메모리 경계에서 벗어난다면, 다른 프로그램에 영향을 끼칠 수 있다.
- 한계 레지스터 (Limit Register): 프로그램이 가질 수 있는 논리 주소의 최대 크기를 저장한다.
- CPU 가 메모리 접근 전, 논리 주소가 한계 레지스터보다 작은 지 검사한다.
  - 만약, 이를 벗어나면 인터럽트를 발생시켜 실행을 중단한다.

## 6-3. 캐시 메모리

> _CPU 가 메모리에 접근하는 시간은 CPU 연산 속도보다 느리다._ > _이를 극복하기 위해 캐시 메모리가 등장했다._

### 저장 장치 계층 구조 (Memory Hierarchy)

### ![hierarchy](https://diveintosystems.org/book/C11-MemHierarchy/_images/MemoryHierarchy.png)

- 컴퓨터가 사용하는 저장 장치들은 CPU 에 얼마나 가까운가를 기준으로 계층적으로 나타낼 수 있다.
  - 가령, 레지스터는 메모리에 비해 속도가 빠르고, 용량은 작고, 가격은 비싸다.

### 캐시 메모리

- 캐시 메모리란

  - SRAM 기반의 저장 장치이며, CPU 와 메모리 사이에 위치하고 레지스터보다 용량이 크며 메모리보다 빠르다.

- 컴퓨터 내부엔 여러 개의 캐시 메모리가 있다.

  - CPU 와 가까운 순서대로 L1, L2, L3 캐시라는 계층을 구성한다.

    ![cache](https://tech-society.com/wp-content/uploads/2019/07/skylake-cache-design.png)

    - L1, L2 캐시는 코어 내부에, L3 캐시는 코어 외부에 위치한다.
    - 멀티 코어 프로세서에서 L1, L2 캐시는 코어마다 고유한 캐시 메모리로 할당되고,
      L3 는 여러 코어가 공유하는 형태로 사용된다.
    - L1 캐시는 조금이라도 접근 속도를 빠르게 만들기 위해,
      명령어만을 저장하는 L1I 캐시와 데이터만을 저장하는 L1D 캐시로 분리하는 경우도 있다.

### 참조 지역성 원리

- 메모리는 CPU 가 사용할 법한 대상을 예측하여 저장한다.
  - Cache Hit: 예측한 데이터가 실제로 들어맞아 CPU 에서 활용될 경우
  - Cache Miss: 예측한 데이터가 들어맞지 않는 경우. 이 때는 메모리에서 데이터를 직접 가져와야 한다.
  - Cache Hit Ratio: Cache Hit / (Cache Hit + Cache Miss)
- 참조 지역성의 원리 (locality of reference, principle of locality)
  - CPU 는 최근에 접근했던 메모리 공간에 다시 접근하려는 경향이 있다.
  - CPU 는 접근한 메모리 공간 근처를 접근하려는 경향이 있다. (공간 지역성 - spatial locality)
